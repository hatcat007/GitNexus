---
phase: 02-resilience
plan: 05
type: execute
wave: 3
depends_on:
  - 02-03
  - 02-04
files_modified: []
autonomous: false
must_haves:
  truths:
    - "Timeout enforcement works for quick and heavy tools"
    - "Circuit breaker opens after 5 failures and closes on success"
    - "WebSocket reconnects with exponential backoff"
    - "Error responses include retry guidance for AI agents"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete resilience system works end-to-end through manual testing.

Purpose: Confirm timeout, circuit breaker, and reconnection behaviors are working correctly before marking the phase complete.
Output: Human verification of resilience patterns
</objective>

<execution_context>
@/Users/buddythacat/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/buddythacat/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-resilience/02-CONTEXT.md

# All prior plans in this phase
@.planning/phases/02-resilience/02-01-PLAN.md
@.planning/phases/02-resilience/02-02-PLAN.md
@.planning/phases/02-resilience/02-03-PLAN.md
@.planning/phases/02-resilience/02-04-PLAN.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete resilience system for GitNexus MCP server:
1. **Timeout wrapper** - Two-tier timeouts (60s quick / 120s heavy) via AbortController
2. **Circuit breaker** - opossum-based protection (5 failures → open, 30s cooldown, immediate close on success)
3. **Exponential backoff** - WebSocket reconnection with Full Jitter (500ms → 60s cap)
4. **Error responses** - Structured errors with retry guidance (TIMEOUT, CIRCUIT_OPEN, CONNECTION_LOST, RETRY_EXHAUSTED)
</what-built>
  <how-to-verify>
**Step 1: Build and Start**
```bash
cd gitnexus-mcp
npm run build
npm run start
```

**Step 2: Verify Timeout Configuration**
In a separate terminal, check that environment variables work:
```bash
GITNEXUS_TIMEOUT_QUICK=30000 GITNEXUS_TIMEOUT_HEAVY=60000 npm run start
```
The server should start without errors.

**Step 3: Verify Error Codes**
Check that the new error codes are available:
```bash
node -e "const { ErrorCodes } = require('./dist/mcp/errors.js'); console.log('TIMEOUT:', ErrorCodes.TIMEOUT); console.log('CIRCUIT_OPEN:', ErrorCodes.CIRCUIT_OPEN);"
```

**Step 4: Verify Resilience Module**
Check that resilience utilities exported:
```bash
node -e "const r = require('./dist/mcp/resilience.js'); console.log('Quick tools:', r.QUICK_TOOLS); console.log('Heavy tools:', r.HEAVY_TOOLS); console.log('getTimeout(search):', r.getTimeout('search')); console.log('getTimeout(cypher):', r.getTimeout('cypher')); console.log('calculateBackoff(0):', r.calculateBackoff(0)); console.log('calculateBackoff(5):', r.calculateBackoff(5));"
```

**Step 5: Verify Circuit Breaker Logs**
When the server starts, you should see circuit breaker state logged (if any failures occur):
- "Circuit breaker opened - blocking requests"
- "Circuit breaker half-open - testing with next request"
- "Circuit breaker closed - requests flowing normally"

**Step 6: Verify No Hardcoded Timeouts**
```bash
grep -r "30000" gitnexus-mcp/src --include="*.ts" | grep -v "node_modules" | grep -v ".d.ts"
```
Should NOT find hardcoded 30000 in callTool (the old timeout was replaced with configurable system).

**Expected Results:**
- ✅ Build succeeds
- ✅ Server starts without errors
- ✅ Error codes: TIMEOUT, CIRCUIT_OPEN, CONNECTION_LOST, RETRY_EXHAUSTED
- ✅ getTimeout('search') returns 60000 (or env override)
- ✅ getTimeout('cypher') returns 120000 (or env override)
- ✅ calculateBackoff(0) returns 0-500
- ✅ calculateBackoff(5) returns 0-16000
- ✅ No hardcoded 30000ms timeout in callTool
</how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe issues found</resume-signal>
</task>

</tasks>

<verification>
Human verification confirms:
1. Build succeeds
2. Server starts
3. Error codes present
4. Resilience utilities work correctly
5. No hardcoded timeouts remain
</verification>

<success_criteria>
- All verification steps pass
- No TypeScript compilation errors
- Resilience patterns function as designed
</success_criteria>

<output>
After completion, create `.planning/phases/02-resilience/02-05-SUMMARY.md`
</output>
