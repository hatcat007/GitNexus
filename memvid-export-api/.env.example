# ============================================================================
# memvid-export-api environment reference
# ============================================================================
# This file contains all runtime options parsed by src/config.rs.
# Primary modes:
# - MEMVID_EXPORT_BACKEND_MODE=legacy_vps   (existing local worker path)
# - MEMVID_EXPORT_BACKEND_MODE=runpod_queue (Runpod Queue control-plane path)
#
# Mission-critical recommendation:
# - Use runpod_queue + shared storage + strict Rust memvid-core Runpod worker.
# ============================================================================

# ----------------------------------------------------------------------------
# Authentication and API server
# ----------------------------------------------------------------------------
MEMVID_EXPORT_API_KEY=replace-with-static-bearer-key
# Optional secret-file alternative (used if MEMVID_EXPORT_API_KEY is unset/empty):
# MEMVID_EXPORT_API_KEY_FILE=/run/secrets/memvid_export_api_key

MEMVID_EXPORT_BIND_ADDR=0.0.0.0:8080

# ----------------------------------------------------------------------------
# Export storage and retention
# ----------------------------------------------------------------------------
# Final export files served by /v1/exports/{job_id}/download
MEMVID_EXPORT_ROOT=/data/exports

# Staging for Runpod pointer flow:
# - payloads/<job_id>.json
# - outputs/<job_id>/*.mv2
# Use a shared mount visible to control plane and Runpod worker if using file:// refs.
MEMVID_EXPORT_STAGING_ROOT=/runpod-volume/memvid/staging

# Artifact retention in seconds (default 24h)
MEMVID_EXPORT_RETENTION_SECONDS=86400

# In-memory queue depth for accepted API jobs
MEMVID_EXPORT_QUEUE_CAPACITY=128

# ----------------------------------------------------------------------------
# Backend routing (cutover switch)
# ----------------------------------------------------------------------------
# Values: legacy_vps | runpod_queue
MEMVID_EXPORT_BACKEND_MODE=runpod_queue

# ----------------------------------------------------------------------------
# Runpod queue backend (required when MEMVID_EXPORT_BACKEND_MODE=runpod_queue)
# ----------------------------------------------------------------------------
# Runpod API base for Queue Serverless v2 endpoints.
RUNPOD_API_BASE=https://api.runpod.ai/v2

# Endpoint id from Runpod Serverless endpoint page.
RUNPOD_ENDPOINT_ID=

# API key with permission to submit/status/cancel jobs.
RUNPOD_API_KEY=

# Status poll interval used by control plane while tracking Runpod jobs.
RUNPOD_POLL_INTERVAL_SECONDS=5

# Passed to Runpod run policy (milliseconds).
# Keep above your expected max export runtime.
RUNPOD_EXECUTION_TIMEOUT_MS=600000

# Runpod job TTL policy (milliseconds).
RUNPOD_TTL_MS=86400000

# Informational routing label for ops dashboards/playbooks (not hard-enforced in code).
RUNPOD_REGION_SCOPE=EU-primary

# ----------------------------------------------------------------------------
# Embedding route selection
# ----------------------------------------------------------------------------
# Values: external_api | runpod_gpu
MEMVID_EMBEDDING_MODE=external_api

# Provider label used for telemetry/job metadata.
# Recommended default: nvidia
# Example values: nvidia, openai, voyage, voyageai, ollama, local
MEMVID_EMBED_PROVIDER=nvidia

# Explicit embedding model identifier.
# Defaults by provider:
# - nvidia => nvidia/nv-embed-v1
# - openai => text-embedding-3-large
# - voyage/voyageai => voyage-code-3
# - ollama/local => nomic-embed-text
MEMVID_EMBED_MODEL=nvidia/nv-embed-v1

# Request timeout for embedding HTTP calls.
MEMVID_EMBED_REQUEST_TIMEOUT_SECONDS=60

# Required if using external_api + nvidia provider.
NVIDIA_API_KEY=
NVIDIA_EMBED_BASE_URL=https://integrate.api.nvidia.com/v1

# Required if using external_api + openai provider.
OPENAI_API_KEY=
OPENAI_EMBED_BASE_URL=https://api.openai.com/v1

# Required if using external_api + voyage/voyageai provider.
VOYAGE_API_KEY=
VOYAGE_EMBED_BASE_URL=https://api.voyageai.com/v1
# For retrieval quality, keep `document` for indexing exports and `query` for search queries.
VOYAGE_INPUT_TYPE=document
# Optional dimensions for voyage-code-3: 2048, 1024, 512, 256
VOYAGE_OUTPUT_DIMENSION=1024
# float | int8 | uint8 | binary | ubinary
VOYAGE_OUTPUT_DTYPE=float
# true -> truncate over-length inputs; false -> provider errors on over-length
VOYAGE_TRUNCATION=true

# Required when MEMVID_EMBEDDING_MODE=runpod_gpu (Ollama-compatible endpoint).
# Example: http://127.0.0.1:11434
OLLAMA_HOST=

# ----------------------------------------------------------------------------
# MCP read-side controls
# ----------------------------------------------------------------------------
MEMVID_MCP_RESPONSE_BUDGET_BYTES=65536
MEMVID_MCP_RATE_LIMIT_PER_MINUTE=120
MEMVID_MCP_RATE_LIMIT_BURST=60
MEMVID_MCP_DEV_LOG_PAYLOADS=false
MEMVID_MCP_ALLOW_EXTERNAL_CAPSULES=false
MEMVID_MCP_CACHE_CAPACITY=256

# ----------------------------------------------------------------------------
# Quick-start profile snippets (copy values as needed)
# ----------------------------------------------------------------------------
# Legacy VPS profile:
#   MEMVID_EXPORT_BACKEND_MODE=legacy_vps
#
# Runpod Queue profile (EU primary, reliability-first):
#   MEMVID_EXPORT_BACKEND_MODE=runpod_queue
#   RUNPOD_API_BASE=https://api.runpod.ai/v2
#   RUNPOD_ENDPOINT_ID=<your-endpoint-id>
#   RUNPOD_API_KEY=<your-runpod-api-key>
#   MEMVID_EXPORT_STAGING_ROOT=/runpod-volume/memvid/staging
#   MEMVID_EMBEDDING_MODE=external_api
#   MEMVID_EMBED_PROVIDER=nvidia
#   MEMVID_EMBED_MODEL=nvidia/nv-embed-v1
#   NVIDIA_API_KEY=<your-nim-key>
#
# Voyage external embedding profile (voyage-code-3):
#   MEMVID_EMBEDDING_MODE=external_api
#   MEMVID_EMBED_PROVIDER=voyage
#   MEMVID_EMBED_MODEL=voyage-code-3
#   VOYAGE_API_KEY=<your-voyage-api-key>
#   VOYAGE_INPUT_TYPE=document
#   VOYAGE_OUTPUT_DIMENSION=1024
#   VOYAGE_OUTPUT_DTYPE=float
#   VOYAGE_TRUNCATION=true
#
# Runpod GPU embedding profile:
#   MEMVID_EMBEDDING_MODE=runpod_gpu
#   MEMVID_EMBED_PROVIDER=ollama
#   MEMVID_EMBED_MODEL=nomic-embed-text
#   OLLAMA_HOST=http://127.0.0.1:11434
# ----------------------------------------------------------------------------
